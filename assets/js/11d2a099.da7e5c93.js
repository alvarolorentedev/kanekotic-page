"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1455],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=l(n),m=r,g=u["".concat(p,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(g,o(o({ref:t},c),{},{components:n})):a.createElement(g,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var l=2;l<i;l++)o[l]=n[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4576:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var a=n(7462),r=(n(7294),n(3905));const i={title:"Update your npm package dependencies and release with Travis",summary:"Update your npm package dependencies and release with Travis",description:"Update your npm package dependencies and release with Travis",date:new Date("2018-07-11T07:27:28.000Z"),tags:["ci","cd","versioning","npm","travis","travisci","github","cron"],draft:!1,published:!1},o=void 0,s={permalink:"/blog/2018/07/11/travis-ci-update-npm-package-dependencies-and-release",editUrl:"https://github.com/kanekotic/kanekotic-page/tree/main/blog/2018-07-11-travis-ci-update-npm-package-dependencies-and-release.md",source:"@site/blog/2018-07-11-travis-ci-update-npm-package-dependencies-and-release.md",title:"Update your npm package dependencies and release with Travis",description:"Update your npm package dependencies and release with Travis",date:"2018-07-11T07:27:28.000Z",formattedDate:"July 11, 2018",tags:[{label:"ci",permalink:"/blog/tags/ci"},{label:"cd",permalink:"/blog/tags/cd"},{label:"versioning",permalink:"/blog/tags/versioning"},{label:"npm",permalink:"/blog/tags/npm"},{label:"travis",permalink:"/blog/tags/travis"},{label:"travisci",permalink:"/blog/tags/travisci"},{label:"github",permalink:"/blog/tags/github"},{label:"cron",permalink:"/blog/tags/cron"}],readingTime:2.01,hasTruncateMarker:!1,authors:[],frontMatter:{title:"Update your npm package dependencies and release with Travis",summary:"Update your npm package dependencies and release with Travis",description:"Update your npm package dependencies and release with Travis",date:"2018-07-11T07:27:28.000Z",tags:["ci","cd","versioning","npm","travis","travisci","github","cron"],draft:!1,published:!1},prevItem:{title:"Stop doing PR's inside the Office",permalink:"/blog/2022/08/08/stop-prs"},nextItem:{title:"Create your User/Organization GitHub Page with Hugo + Travis",permalink:"/blog/2018/07/04/deploy-hugo-with-travis"}},p={authorsImageUrls:[]},l=[],c={toc:l};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"As a member of the community that like to generate npm packages like libraries and cli tools, sometimes is difficult to maintain everything and keep your package up to date in the dependencies side. I am a fan of having static dependencies as versioning is not being held correctly in most of the npm world. So if you dont use exact packages you could run in the issue that a broken change makes from the night to the morning your awesome tool to break."),(0,r.kt)("p",null,"This practice could bring a headache to keep dependencies up to date because is a manual process. And manual process tend to be time consuming (at this point in time I have ~17 npm packages) meaning that if i want to simply do normal maintenance i will have to run everything for all those in maybe weekly or monthly bases. "),(0,r.kt)("p",null,"So is a bit of a no situation for maintainers, but if you dont maintain your package people will not use it, because there is a concern about how active the project is, even if there are no open issues. For solving both of this things what i have decided is to ad to my CI/CD pipeline a script that runs only on cron jobs from travis ci."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yml"},'os: osx\nlanguage: node_js\nnode_js:\n  - node\nscript:\n  - yarn test:cov\nafter_success:\n  - if [[ "${TRAVIS_EVENT_TYPE}" = "cron" ]]; then ./upgrade.sh; fi\ndeploy:\n  skip_cleanup: true\n  provider: npm\n  email: $NPM_EMAIL\n  api_key: $NPM_TOKEN\n  on:\n    tags: true\n')),(0,r.kt)("p",null,"as you can see that is the normal ",(0,r.kt)("inlineCode",{parentName:"p"},".travis.yml")," for deploying into npm (you will have to define ",(0,r.kt)("inlineCode",{parentName:"p"},"NPM_EMAIL")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"NPM_TOKEN")," as enviroment variables in your build configuration), the main diference is the step after success that if its the cron job going will run the next script."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/sh\n\nset -e\n\ngit config --global user.email $GH_EMAIL\ngit config --global user.name $GH_USER\n\ngit remote add origin-master https://${GH_TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git > /dev/null 2>&1\n\ngit fetch origin-master\ngit checkout -b master-local origin-master/master\n\nyarn upgrade --latest\ngit add .\ngit commit --allow-empty -m "updated dependencies [skip ci]"\n\nyarn test\nyarn version --patch\n\ngit push --quiet origin-master master-local:master\ngit push --quiet origin-master master-local:master --tags\n')),(0,r.kt)("p",null,"this script attaches the current state to a branch makes, upgrades the dependencies and if everything works fine generates a new commit and deploy a patch of the packages (you will have to define ",(0,r.kt)("inlineCode",{parentName:"p"},"GH_EMAIL"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"GH_USER")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"GH_TOKEN")," as environment variables in your build configuration)."))}d.isMDXComponent=!0}}]);